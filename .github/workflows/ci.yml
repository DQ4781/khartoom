name: CI Pipeline

on:
  push:
    branches:
      - v2 # TODO: switch to main when merging
  pull_request:
    branches:
      - v2 # TODO: switch to main when merging

      # Trigger build
jobs:
  build:
    runs-on: ubuntu-latest

    env:
      AWS_DEFAULT_REGION: us-west-2
      AWS_REGION: us-west-2

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.x"

      - name: Install dependencies
        run: |
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

      - name: Debug AWS Region
        run: |
          echo "AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION"
          echo "AWS_REGION: $AWS_REGION"

      # TODO: uncomment this & get UTs to mock AWS properly
      # - name: Run Configuration Service Lambda Tests
      #   run: |
      #     cd configuration-service
      #     python3 -W ignore::DeprecationWarning -m unittest test_config.py

      # - name: Run Ingestion Service Lambda Tests
      #   run: |
      #     cd ingestion-service
      #     python3 -W ignore::DeprecationWarning -m unittest test_ingestion.py

      # - name: Run Transformation Service Lambda Tests
      #   run: |
      #     cd transformation-service
      #     python3 -W ignore::DeprecationWarning -m unittest test_transform.py

      # - name: Run Delivery Service Lambda Tests
      #   run: |
      #     cd delivery-service
      #     python3 -W ignore::DeprecationWarning -m unittest test_delivery.py
